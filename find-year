#!/bin/sh

first=$1
if [ -z "$first" ]; then
	first=1990
fi

success='???'

for year in `seq "$first" -1 1962`; do
	response="`curl \
		--silent \
		https://user-api.coronatest.nl/vaccinatie/programma/booster/$year/NEE \
	`"

	#echo "$year $response"
	echo "$response" | grep 'Rate limit' && exit 1

	if echo "$response" |  grep '{"success":true}' ; then
		echo >&2 "$year"
		success="$year"
		break
	fi

	# limit rate of requests
	sleep 2
done

now="`date '+%Y-%m-%d %H:%M:%S'`"
cat template.html \
	| sed "s/YEAR/$year/" \
	| sed "s/WHEN/$now/" \
> index.html
